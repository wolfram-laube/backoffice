<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timesheet | Blauweiss-EDV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è±Ô∏è</text></svg>">
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const TimesheetApp = () => {
  const [customer, setCustomer] = React.useState({
    name: 'Krongaard AG',
    address: 'K√∂nigstra√üe 10',
    city: '20095 Hamburg',
    country: 'Germany',
    vat_id: 'DE287315258'
  });
  
  const [projectNr, setProjectNr] = React.useState('KRO-2026-001');
  const [rate, setRate] = React.useState(105);
  const [entries, setEntries] = React.useState([]);
  const [newEntry, setNewEntry] = React.useState({
    date: new Date().toISOString().split('T')[0],
    hours: 8,
    description: ''
  });

  // Load from localStorage
  React.useEffect(() => {
    const saved = localStorage.getItem('timesheet-data');
    if (saved) {
      const data = JSON.parse(saved);
      setCustomer(data.customer || customer);
      setProjectNr(data.projectNr || projectNr);
      setRate(data.rate || rate);
      setEntries(data.entries || []);
    }
  }, []);

  // Save to localStorage
  React.useEffect(() => {
    localStorage.setItem('timesheet-data', JSON.stringify({
      customer, projectNr, rate, entries
    }));
  }, [customer, projectNr, rate, entries]);

  const addEntry = () => {
    if (newEntry.description && newEntry.hours > 0) {
      setEntries([...entries, { ...newEntry }]);
      setNewEntry({
        date: newEntry.date,
        hours: 8,
        description: ''
      });
    }
  };

  const removeEntry = (index) => {
    setEntries(entries.filter((_, i) => i !== index));
  };

  const clearAll = () => {
    if (confirm('Alle Eintr√§ge l√∂schen?')) {
      setEntries([]);
    }
  };

  const totalHours = entries.reduce((sum, e) => sum + e.hours, 0);
  const totalAmount = totalHours * rate;

  const generateYAML = () => {
    const yaml = `# Timesheet: ${customer.name}
# Generated: ${new Date().toISOString()}

customer:
  name: "${customer.name}"
  address: "${customer.address}"
  city: "${customer.city}"
  country: "${customer.country}"
  vat_id: "${customer.vat_id}"

project_nr: "${projectNr}"
rate: ${rate}.00

entries:
${entries.map(e => `  - date: ${e.date}
    hours: ${e.hours}
    description: "${e.description}"`).join('\n')}
`;
    return yaml;
  };

  const downloadYAML = () => {
    const yaml = generateYAML();
    const blob = new Blob([yaml], { type: 'text/yaml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const month = entries[0]?.date?.substring(0, 7) || new Date().toISOString().substring(0, 7);
    const customerShort = customer.name.toLowerCase().replace(/[^a-z]/g, '').substring(0, 10);
    a.href = url;
    a.download = `${month}-${customerShort}.yaml`;
    a.click();
  };

  const copyYAML = () => {
    navigator.clipboard.writeText(generateYAML());
    alert('YAML kopiert!');
  };

  return (
    <div className="min-h-screen bg-slate-900 text-white p-4 md:p-6">
      <div className="max-w-4xl mx-auto">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold text-cyan-400">‚è±Ô∏è Timesheet</h1>
            <p className="text-slate-400 text-sm">Stundenerfassung ‚Üí YAML ‚Üí Invoice</p>
          </div>
          <img src="https://gitlab.com/wolfram_laube/blauweiss_llc/freelancer-admin/-/raw/main/modules/invoicing/templates/logo-blauweiss.png" 
               alt="Blauweiss" className="h-10 hidden md:block" />
        </div>

        {/* Customer & Project */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div className="bg-slate-800 rounded-lg p-4">
            <h2 className="text-lg font-semibold text-cyan-400 mb-3">üë§ Kunde</h2>
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 mb-2 text-sm"
              placeholder="Firmenname"
              value={customer.name}
              onChange={(e) => setCustomer({...customer, name: e.target.value})}
            />
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 mb-2 text-sm"
              placeholder="Adresse"
              value={customer.address}
              onChange={(e) => setCustomer({...customer, address: e.target.value})}
            />
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 mb-2 text-sm"
              placeholder="PLZ Ort"
              value={customer.city}
              onChange={(e) => setCustomer({...customer, city: e.target.value})}
            />
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 mb-2 text-sm"
              placeholder="Land"
              value={customer.country}
              onChange={(e) => setCustomer({...customer, country: e.target.value})}
            />
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 text-sm"
              placeholder="VAT ID"
              value={customer.vat_id}
              onChange={(e) => setCustomer({...customer, vat_id: e.target.value})}
            />
          </div>

          <div className="bg-slate-800 rounded-lg p-4">
            <h2 className="text-lg font-semibold text-cyan-400 mb-3">üìã Projekt</h2>
            <input
              className="w-full bg-slate-700 rounded px-3 py-2 mb-3 text-sm"
              placeholder="Projekt-Nr."
              value={projectNr}
              onChange={(e) => setProjectNr(e.target.value)}
            />
            <div className="flex items-center gap-2">
              <span className="text-slate-400 text-sm">Stundensatz:</span>
              <input
                type="number"
                className="w-24 bg-slate-700 rounded px-3 py-2 text-sm"
                value={rate}
                onChange={(e) => setRate(Number(e.target.value))}
              />
              <span className="text-slate-400 text-sm">‚Ç¨/h</span>
            </div>
          </div>
        </div>

        {/* New Entry */}
        <div className="bg-slate-800 rounded-lg p-4 mb-6">
          <h2 className="text-lg font-semibold text-cyan-400 mb-3">‚ûï Neuer Eintrag</h2>
          <div className="flex flex-wrap gap-2 md:gap-3">
            <input
              type="date"
              className="bg-slate-700 rounded px-3 py-2 text-sm"
              value={newEntry.date}
              onChange={(e) => setNewEntry({...newEntry, date: e.target.value})}
            />
            <div className="flex items-center gap-1">
              <input
                type="number"
                step="0.5"
                min="0"
                max="24"
                className="w-16 bg-slate-700 rounded px-2 py-2 text-sm"
                value={newEntry.hours}
                onChange={(e) => setNewEntry({...newEntry, hours: Number(e.target.value)})}
              />
              <span className="text-slate-400 text-sm">h</span>
            </div>
            <input
              className="flex-1 min-w-[200px] bg-slate-700 rounded px-3 py-2 text-sm"
              placeholder="Beschreibung (z.B. Kubernetes Migration)"
              value={newEntry.description}
              onChange={(e) => setNewEntry({...newEntry, description: e.target.value})}
              onKeyDown={(e) => e.key === 'Enter' && addEntry()}
            />
            <button
              onClick={addEntry}
              className="bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded font-semibold text-sm"
            >
              + Add
            </button>
          </div>
        </div>

        {/* Entries List */}
        <div className="bg-slate-800 rounded-lg p-4 mb-6">
          <div className="flex justify-between items-center mb-3">
            <h2 className="text-lg font-semibold text-cyan-400">üìù Eintr√§ge</h2>
            {entries.length > 0 && (
              <button onClick={clearAll} className="text-red-400 hover:text-red-300 text-sm">
                üóëÔ∏è Clear
              </button>
            )}
          </div>
          {entries.length === 0 ? (
            <p className="text-slate-500 italic text-sm">Noch keine Eintr√§ge...</p>
          ) : (
            <div className="space-y-2">
              {entries.map((entry, i) => (
                <div key={i} className="flex items-center gap-2 md:gap-3 bg-slate-700 rounded px-3 py-2 text-sm">
                  <span className="text-slate-400 w-24 md:w-28">{entry.date}</span>
                  <span className="text-cyan-400 w-12 text-right">{entry.hours}h</span>
                  <span className="flex-1 truncate">{entry.description}</span>
                  <span className="text-green-400 w-20 text-right hidden md:block">‚Ç¨{(entry.hours * rate).toFixed(2)}</span>
                  <button
                    onClick={() => removeEntry(i)}
                    className="text-red-400 hover:text-red-300 px-1"
                  >
                    ‚úï
                  </button>
                </div>
              ))}
            </div>
          )}
          
          {entries.length > 0 && (
            <div className="flex justify-end gap-4 mt-4 pt-4 border-t border-slate-600">
              <span className="text-slate-400">Gesamt:</span>
              <span className="text-cyan-400 font-bold">{totalHours}h</span>
              <span className="text-green-400 font-bold text-xl">‚Ç¨{totalAmount.toFixed(2)}</span>
            </div>
          )}
        </div>

        {/* Export */}
        {entries.length > 0 && (
          <div className="bg-slate-800 rounded-lg p-4">
            <h2 className="text-lg font-semibold text-cyan-400 mb-3">üì§ Export</h2>
            <div className="flex flex-wrap gap-3 mb-4">
              <button
                onClick={downloadYAML}
                className="bg-green-600 hover:bg-green-500 px-5 py-2 rounded font-semibold text-sm"
              >
                ‚¨áÔ∏è YAML Download
              </button>
              <button
                onClick={copyYAML}
                className="bg-slate-600 hover:bg-slate-500 px-5 py-2 rounded font-semibold text-sm"
              >
                üìã Kopieren
              </button>
            </div>
            <details className="text-sm">
              <summary className="cursor-pointer text-slate-400 hover:text-slate-300">YAML Preview</summary>
              <pre className="bg-slate-900 rounded p-3 text-xs text-slate-300 overflow-x-auto mt-2 max-h-48">
                {generateYAML()}
              </pre>
            </details>
          </div>
        )}

        <p className="text-center text-slate-600 text-xs mt-6">
          Blauweiss-EDV LLC | <a href="https://gitlab.com/wolfram_laube/blauweiss_llc/freelancer-admin" className="hover:text-slate-400">GitLab</a>
        </p>
      </div>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<TimesheetApp />);
    </script>
</body>
</html>
